<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Max & Bunny Menu</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Plus+Jakarta+Sans:wght@600;700;800&display=swap"
      rel="stylesheet"
    />

    <link rel="stylesheet" href="style/menu.css" />
  </head>

  <body>
    <!-- HEADER -->
    <header class="header">
      <div class="header-inner">
        <img
          src="https://prteyzbjjzkfyogphwrg.supabase.co/storage/v1/object/public/menu-images/logo/maxbunny.jpg"
          alt="Max & Bunny Logo"
          class="logo"
        />
        <div class="brand">
          <h1>Max & Bunny</h1>
          <p>Scan • Browse • Enjoy</p>
        </div>
        <!-- FILTER BAR -->
    <div style="margin-left: auto;" class="menu-filters">
      <div class="search-wrap">
        <input
          type="search"
          id="searchInput"
          placeholder="Search menu…"
          aria-label="Search menu"
        />
        <button id="clearSearch" aria-label="Clear search">×</button>
      </div>

      <select id="priceFilter" aria-label="Sort by price">
        <option value="">Sort by</option>
        <option value="low-high">Price: Low → High</option>
        <option value="high-low">Price: High → Low</option>
      </select>
    </div>
      </div>
    </header>

    

    <!-- CONTENT -->
    <main class="container">
      <div id="menu" class="menu-grid"></div>
      <div id="state" class="loading">Loading menu…</div>
    </main>

    <!-- MODAL -->
    <div id="modalOverlay" class="modal-overlay">
      <div class="modal">
        <button class="close-btn" id="closeModal">×</button>
        <img id="modalImg" />
        <div class="modal-content">
          <div class="modal-header">
            <h3 id="modalTitle"></h3>
            <span class="modal-price" id="modalPrice"></span>
          </div>
          <div class="modal-desc" id="modalDesc"></div>
        </div>
      </div>
    </div>

    <!-- SCRIPT -->
    <script type="module">
      import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

      const SUPABASE_URL = "https://prteyzbjjzkfyogphwrg.supabase.co";
      const SUPABASE_KEY =
        "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBydGV5emJqanprZnlvZ3Bod3JnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk0ODI0MTYsImV4cCI6MjA4NTA1ODQxNn0.VWJS8IcAhXSucmgQiOw9fpl79apwCYOmTdaC31_Invw";

      const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

      const menuEl = document.getElementById("menu");
      const stateEl = document.getElementById("state");
      const searchInput = document.getElementById("searchInput");
      const priceFilter = document.getElementById("priceFilter");

      const modalOverlay = document.getElementById("modalOverlay");
      const modalImg = document.getElementById("modalImg");
      const modalTitle = document.getElementById("modalTitle");
      const modalPrice = document.getElementById("modalPrice");
      const modalDesc = document.getElementById("modalDesc");
      const closeModal = document.getElementById("closeModal");

      let allItems = [];

      /* ==============================
         FETCH + RENDER
      ============================== */

      async function fetchItems() {
        const { data, error } = await supabase
          .from("menu_items")
          .select("*")
          .order("created_at", { ascending: false });

        if (error) {
          stateEl.textContent = error.message;
          return;
        }

        if (!data.length) {
          stateEl.className = "empty";
          stateEl.textContent = "Menu is currently unavailable";
          return;
        }

        stateEl.remove();
        allItems = data;
        renderItems(allItems);
      }

      function renderItems(items) {
        menuEl.innerHTML = "";

        if (!items.length) {
          menuEl.innerHTML = '<p class="empty">No items found</p>';
          return;
        }

        items.forEach((item) => {
          const card = document.createElement("div");
          card.className = "card";

          card.dataset.name = item.name;
          card.dataset.price = item.price;
          card.dataset.desc = item.description || "";
          card.dataset.img = item.image_url;

          card.innerHTML = `
            <img src="${item.image_url}" alt="${item.name}" />
            <div class="card-content">
              <div class="card-header">
                <h3>${item.name}</h3>
                <div class="price">₱${item.price}</div>
              </div>
              <div class="desc clamp">
                ${item.description || ""}
              </div>
            </div>
          `;

          menuEl.appendChild(card);
        });
      }

      /* ==============================
         SEARCH + SORT
      ============================== */

      function applyFilters() {
        const term = searchInput.value.toLowerCase().trim();
        const sort = priceFilter.value;

        let filtered = allItems.filter(
          (item) =>
            item.name.toLowerCase().includes(term) ||
            (item.description || "").toLowerCase().includes(term),
        );

        if (sort === "low-high") {
          filtered.sort((a, b) => a.price - b.price);
        }

        if (sort === "high-low") {
          filtered.sort((a, b) => b.price - a.price);
        }

        renderItems(filtered);
      }

      clearSearch.onclick = () => {
        searchInput.value = "";
        applyFilters();
        searchInput.focus();
      };

      searchInput.addEventListener("input", applyFilters);
      priceFilter.addEventListener("change", applyFilters);

      /* ==============================
         MODAL
      ============================== */

      menuEl.addEventListener("click", (e) => {
        const card = e.target.closest(".card");
        if (!card) return;

        modalImg.src = card.dataset.img;
        modalTitle.textContent = card.dataset.name;
        modalPrice.textContent = `₱${card.dataset.price}`;
        modalDesc.textContent =
          card.dataset.desc || "No description available.";

        modalOverlay.classList.add("active");
      });

      closeModal.onclick = () => modalOverlay.classList.remove("active");

      modalOverlay.onclick = (e) => {
        if (e.target === modalOverlay) {
          modalOverlay.classList.remove("active");
        }
      };

      /* ==============================
         INIT
      ============================== */

      fetchItems();
    </script>
  </body>
</html>
